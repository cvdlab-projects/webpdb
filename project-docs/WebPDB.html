<html><head><title>WebPDB</title><style type="text/css">ol{margin:0;padding:0}.c13{vertical-align:top;width:468pt;border-style:solid;border-color:#000000;border-width:1pt;padding:5pt 5pt 5pt 5pt}.c19{color:#333333;font-size:9pt;background-color:#ffffff;font-family:"Verdana"}.c6{color:#dd1144;font-size:9pt;background-color:#ffffff;font-family:"Verdana"}.c23{color:#999988;font-size:9pt;background-color:#ffffff;font-family:"Verdana"}.c7{list-style-type:disc;margin:0;padding:0}.c25{max-width:468pt;background-color:#ffffff;padding:72pt 72pt 72pt 72pt}.c9{color:#666666;font-size:12pt;font-weight:bold}.c1{color:#1155cc;text-decoration:underline}.c2{color:inherit;text-decoration:inherit}.c10{margin-left:72pt}.c5{border-collapse:collapse}.c4{height:11pt}.c3{font-style:italic}.c27{margin-right:8pt}.c12{margin-left:36pt}.c20{font-weight:bold}.c21{color:#8b8b8b}.c8{height:0pt}.c18{color:#ff0000}.c29{font-size:14pt}.c24{margin-left:90pt}.c16{line-height:1.0}.c28{padding-left:0pt}.c22{color:#666666}.c14{font-size:12pt}.c26{text-indent:36pt}.c11{height:12pt}.c17{margin-left:54pt}.c15{margin-left:18pt}.c0{direction:ltr}.c30{font-size:25pt}.title{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:36pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}.subtitle{padding-top:18pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:24pt;font-family:"Georgia";padding-bottom:4pt}li{color:#000000;font-size:11pt;font-family:"Arial"}p{color:#000000;font-size:11pt;margin:0;font-family:"Arial"}h1{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:18pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}h2{padding-top:18pt;line-height:1.15;text-align:left;color:#000000;font-size:14pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h3{padding-top:14pt;line-height:1.15;text-align:left;color:#666666;font-size:12pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h4{padding-top:12pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:11pt;font-family:"Arial";padding-bottom:2pt}h5{padding-top:11pt;line-height:1.15;text-align:left;color:#666666;font-size:10pt;font-family:"Arial";font-weight:bold;padding-bottom:2pt}h6{padding-top:10pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:10pt;font-family:"Arial";padding-bottom:2pt}</style></head><body class="c25"><p class="c0 title"><a name="h.wpcj1bitcp2e"></a><span>WebPDB</span></p><p class="c4 c0"><span></span></p><p class="c15 c0"><span class="c1"><a class="c2" href="#h.9hxkrks1kkzz">ZFS</a></span></p><p class="c15 c0"><span class="c1"><a class="c2" href="#h.dzsa2o58rw3e">Rest Node.js</a></span></p><p class="c15 c0"><span class="c1"><a class="c2" href="#h.nhjevdv29e6q">Parser</a></span></p><p class="c17 c0"><span class="c1"><a class="c2" href="#h.v760onrrwf2g">Input</a></span></p><p class="c10 c0"><span class="c1"><a class="c2" href="#h.rnq800t5lh4p">Proteine, aminoacidi e monomeri in formato PDB</a></span></p><p class="c17 c0"><span class="c1"><a class="c2" href="#h.e7kpm1is0s24">Output</a></span></p><p class="c10 c0"><span class="c1"><a class="c2" href="#h.vd31j6umtxu1">Rappresentazione di record</a></span></p><p class="c10 c0"><span class="c1"><a class="c2" href="#h.jawz7hl3sa09">Campi dei record</a></span></p><p class="c10 c0"><span class="c1"><a class="c2" href="#h.sd8mtkvc5kh0">Record di &ldquo;raggruppamento&rdquo;</a></span></p><p class="c0 c15"><span class="c1"><a class="c2" href="#h.8i8c70tvav8t">CouchDB</a></span></p><p class="c17 c0"><span class="c1"><a class="c2" href="#h.bybcacy042bs">Moduli necessari</a></span></p><p class="c10 c0"><span class="c1"><a class="c2" href="#h.ag03a2vyygoo">Cradle</a></span></p><p class="c0 c24"><span class="c1"><a class="c2" href="#h.w74t47202wqn">Installazione</a></span></p><p class="c17 c0"><span class="c1"><a class="c2" href="#h.rreyr2xldrxp">Avvio CouchDB</a></span></p><p class="c10 c0"><span class="c1"><a class="c2" href="#h.ti1czsm3a8ze">Terminale</a></span></p><p class="c12 c0"><span class="c1"><a class="c2" href="#h.pujkyqqc3quz">Configurazione</a></span></p><p class="c10 c0"><span class="c1"><a class="c2" href="#h.kfthkdoa9hhv">Interfaccia web</a></span></p><p class="c17 c0"><span class="c1"><a class="c2" href="#h.i29ch5wq3l8r">Views</a></span></p><p class="c17 c0"><span class="c1"><a class="c2" href="#h.gotrmfmfw91s">Module hash</a></span></p><p class="c17 c0"><span class="c1"><a class="c2" href="#h.5yhjiylrly63">Module get</a></span></p><p class="c10 c0"><span class="c1"><a class="c2" href="#h.19pp2p34697v">Metodo retrieveByID(id, callbackFunction, keyDB)</a></span></p><p class="c10 c0"><span class="c1"><a class="c2" href="#h.fare46b4k6iu">Metodo retrieveByName(name, callbackFunction, keyDB, start, end)</a></span></p><p class="c10 c0"><span class="c1"><a class="c2" href="#h.bdjt7ymqf9a9">Metodo retrieveByAlmostOneAminoacid(aminoacids, callbackFunction, keyDB, start, end)</a></span></p><p class="c10 c0"><span class="c1"><a class="c2" href="#h.cztvlno4klvh">Metodo retrieveByAllAminoacids(aminoacids, callbackFunction, keyDB, start, end)</a></span></p><p class="c10 c0"><span class="c1"><a class="c2" href="#h.kg72nm91uuxq">Metodo retrieveAllNameID(callbackFunction, keyDB)</a></span></p><p class="c10 c0"><span class="c1"><a class="c2" href="#h.yskj2mpm593d">Metodo retrieveByAlmostOneAminoacidSeqResAverage(aminoacids, callbackFunction, keyDB, start, end) [funzione utile solo a fini di test]</a></span></p><p class="c17 c0"><span class="c1"><a class="c2" href="#h.di7q06jqen5a">Module insert</a></span></p><p class="c10 c0"><span class="c1"><a class="c2" href="#h.6fx856d24k83">Metodo insert(id, json, callbackFunction, keyDB)</a></span></p><p class="c17 c0"><span class="c1"><a class="c2" href="#h.oa61yyx89ng2">Module db</a></span></p><p class="c0 c17"><span class="c1"><a class="c2" href="#h.3r208pwz7j7b">Module queryGenerator</a></span></p><p class="c10 c0"><span class="c1"><a class="c2" href="#h.jx290so8q1ti">mapContains(field, string)</a></span></p><p class="c10 c0"><span class="c1"><a class="c2" href="#h.vj2bhvo5vkt0">mapEqual(field, string)</a></span></p><p class="c10 c0"><span class="c1"><a class="c2" href="#h.puw9ehuxh0bc">mapDisEqual(field, string)</a></span></p><p class="c10 c0"><span class="c1"><a class="c2" href="#h.v9403vbrypmu">mapGreaterThan(field, minVal)</a></span></p><p class="c10 c0"><span class="c1"><a class="c2" href="#h.kg3tgnizyky2">mapLessThan(field, maxVal)</a></span></p><p class="c10 c0"><span class="c1"><a class="c2" href="#h.oa39zsfdqavr">mapBetween(field, minVal, maxVal)</a></span></p><p class="c10 c0"><span class="c1"><a class="c2" href="#h.5ms78muopqhf">almostOneAminoacid(aminoacids)</a></span></p><p class="c10 c0"><span class="c1"><a class="c2" href="#h.3qupe6yny3oe">allAminoacids(aminoacids)</a></span></p><p class="c10 c0"><span class="c1"><a class="c2" href="#h.ecddkdh3vrk7">hasID(aminoacids)</a></span></p><p class="c0 c10"><span class="c1"><a class="c2" href="#h.ek3u5hzpkah">hasNameID(aminoacids)</a></span></p><p class="c10 c0"><span class="c1"><a class="c2" href="#h.tu1gv2cr257k">almostOneAminoacidCountValue(aminoacids) [implementata solo a fini di testing]</a></span></p><p class="c17 c0"><span class="c1"><a class="c2" href="#h.lnsub7a2w2b2">File di configurazione config.json</a></span></p><p class="c17 c0"><span class="c1"><a class="c2" href="#h.6f5j7i7eiksk">File databases.json</a></span></p><p class="c4 c0"><span></span></p><p class="c4 c0"><span></span></p><h1 class="c0"><a name="h.9hxkrks1kkzz"></a><span>ZFS</span></h1><p class="c0"><span>Il filesystem ZFS &egrave; un filesystem 128 bit con capacit&agrave; COW, storage pools, checksumming e silent data protection &amp; integrity. Rilasciato sotto licenza CDDL &egrave; disponibile sotto Linux in due forme: modulo nativo e modulo FUSE. Purtroppo, il modulo nativo &egrave; ancora afflitto da pesanti bug che lo rendono inutilizzabile anche in un sistema di testing, quindi &egrave; stato usato il modulo FUSE (che in quanto userspace subisce un modesto degrado prestazionale).</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>Il filesystem ZFS &egrave; stato impiegato come storage per il db NoSql CouchDB per avere migliori prestazioni e controllo degli errori a causa di malfunzionamenti imprevisti.</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>La creazione di un pool ZFS &egrave; stata eseguita secondo documentazione SUN, creando una partizione primaria (/dev/sda3) e marcandola come tipo </span><span class="c3">Solaris</span><span>&nbsp;aggiuggendola quindi ad un pool chiamato </span><span class="c3">webpdb</span><span>&nbsp;tramite il comando</span><span class="c3">&nbsp;zpool create webpdb /dev/sda3</span><span>&nbsp;inserendo, inoltre, come propriet&agrave; il mountpoint </span><span class="c3">/webpdb</span><span>&nbsp;e quindi utilizzando gli standard tool di linux per il montaggio/smontaggio della partizione.</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>Per testare le sue capacit&agrave; di error recovering, abbiamo corrotto un file del database e utilizzato il tool &ldquo;</span><span class="c3">scrub</span><span>&rdquo; che, in modialit&agrave; online, ha fatto il recovery del file originale e permesso il funzionamento del database senza ulteriori interventi.</span></p><p class="c4 c0"><span></span></p><h1 class="c0"><a name="h.dzsa2o58rw3e"></a><span>Rest Node.js</span></h1><p class="c0"><span>Attraverso l&rsquo;interfaccia REST &egrave; possibile accedere a risorse (informazioni nel nostro caso relative a proteine e molecole) attraverso un identificatore globale (un URI). In questo modo diventa possibile lo scambio di risorse tra client e server che, attraverso un&rsquo;interfaccia standard come HTTP, si scambiano informazioni tipicamente rappresentate in formato json.</span></p><p class="c0"><span>L&rsquo;interfaccia sviluppata sfrutta alcuni moduli disponibili per Node.js, di cui si parler&agrave; a breve.</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>All&rsquo;interfaccia REST &egrave; stata affiancata un&rsquo;interfaccia grafica visibile in localhost, la quale presenta (nella sua versione alfa) due form distinte che innescano due richieste &ldquo;get&rdquo; (ovvero in cui i parametri della ricerca nel db sono visibili nello url).</span></p><p class="c0 c4"><span></span></p><p class="c0"><span>Inizialmente si &egrave; pensato di salvare direttamente su filesystem (in formato .json) i dati della proteina cercata (e trovata con successo) nel db, ottenuti tramite la risposta del server.</span></p><p class="c0"><span>In un secondo momento, a causa della grande mole di dati che i file contenevano, si &egrave; preferito non salvare file in locale ma restituire semplicemente il json tramite interfaccia REST.</span></p><p class="c4 c0"><span></span></p><p class="c4 c0"><span></span></p><p class="c0"><span class="c9">Moduli necessari</span><span class="c20"><br></span></p><ol class="c7" start="1"><li class="c12 c28 c0"><span class="c20">Express</span></li></ol><p class="c26 c0"><span>Permette di interagire in modo immediato con le richieste e le risposte della pagina web.</span></p><p class="c4 c26 c0"><span></span></p><p class="c12 c0"><span>Per quanto riguarda express &egrave; necessario installarlo e importarlo.</span></p><p class="c12 c0"><span>&nbsp;</span></p><a href="#" name="500d58e4bd2b8c65aa8dca79c5aa056b8a2537de"></a><a href="#" name="0"></a><table cellpadding="0" cellspacing="0" class="c5"><tbody><tr class="c8"><td class="c13"><p class="c27 c12 c0"><span>$ npm install express</span></p></td></tr></tbody></table><h3 class="c12 c11 c0"><a name="h.rdkoku3ybz31"></a></h3><p class="c12 c0"><span>Per creare un&rsquo;istanza dell&rsquo; </span><span class="c3">express.HTTPServer</span><span>, si pu&ograve; semplicemente invocare il metodo </span><span class="c3">createServer()</span><span>. </span></p><p class="c4 c0 c12"><span></span></p><a href="#" name="b8df1a9e5b08b9f66dd2a23bc20bb09aba6fd95d"></a><a href="#" name="1"></a><table cellpadding="0" cellspacing="0" class="c5"><tbody><tr class="c8"><td class="c13"><p class="c12 c0 c27"><span>var app = require(&#39;express&#39;).createServer();</span></p></td></tr></tbody></table><p class="c4 c27 c12 c0"><span class="c21"></span></p><p class="c12 c0"><span class="c9">Routes</span></p><p class="c4 c12 c0"><span class="c21"></span></p><p class="c12 c0"><span class="c21">GET &amp; POST // Da approfondire in fase di rifinitura. Ovviamente il login per l&rsquo;admin sar&agrave; una post, tutto il resto pu&ograve; essere una get.</span></p><p class="c4 c26 c0"><span></span></p><ol class="c7" start="1"><li class="c12 c0 c28"><span>Redis</span></li></ol><p class="c12 c0"><span>permette di gestire le sessioni e i cookies. In questo modo &egrave; possibile implementare due modalit&agrave; di accesso alle funzioni offerte tramite l&rsquo;interfaccia grafica: </span><span class="c3">utente</span><span>&nbsp;(consultazione dei dati nel server) e </span><span class="c3">amministratore</span><span>&nbsp;(con possibilit&agrave; di inserire, eliminare e modificare dati dal db).</span></p><p class="c26 c0"><span>Questa fase &egrave; stata per&ograve; momentaneamente accantonata.</span></p><p class="c4 c0 c26"><span></span></p><ol class="c7" start="1"><li class="c12 c28 c0"><span>fs</span></li></ol><p class="c12 c0"><span>grazie ad esso &egrave; possibile l&rsquo;interazione col filesystem, permettendo quindi di salvare file ottenuti dal server, in locale.</span></p><p class="c4 c12 c0"><span><br></span></p><p class="c4 c0"><span></span></p><p class="c0"><span class="c9">Module store.js</span></p><p class="c0"><span>Sfrutta il modulo &lsquo;fs&rsquo; per scrivere i dati ottenuti nel filesystem:</span></p><p class="c4 c0"><span></span></p><p class="c0"><span class="c3 c18">Metodo storeJson (bool, Data)</span></p><p class="c0"><span class="c3">- bool &rarr; se true i dati devono essere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; scritti su disco (non ci sono errori), false altrimenti</span></p><p class="c0"><span class="c3">- Data &rarr; dati in formato json eventualmente da scrivere (attraverso la funzione &lsquo;writefile()&rsquo; di fs.js):</span></p><p class="c4 c0"><span></span></p><p class="c12 c0"><span class="c3 c22">// Richiesta modulo fs</span></p><p class="c12 c0"><span class="c3 c22">var fs = require(&#39;fs&#39;); <br><br>// Scrivere file in locale</span></p><p class="c12 c0"><span class="c3 c22">fs.writeFile();</span></p><p class="c4 c0"><span></span></p><p class="c4 c0"><span></span></p><p class="c0"><span class="c9">Module restUtility.js</span></p><p class="c0"><span>Fornisce alcune funzioni di controllo che vengono sfruttate da </span><span class="c3">server_express.js</span></p><p class="c4 c0"><span></span></p><p class="c0"><span class="c3 c18">Metodo checkIdProtein (id)</span></p><p class="c0"><span class="c3">- id &rarr; id della proteina da cercare nel DB</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>Controlla se l&rsquo;id della proteina passata come parametro &egrave; valida: l&rsquo;id &egrave; valido se &egrave; composto esattamente da 4 caratteri, che consistono di numeri e/o lettere maiuscole.</span></p><p class="c0"><span>La funzione ritorna un booleano (true se l&rsquo;id &egrave; valido, false altrimenti).</span></p><p class="c4 c0"><span></span></p><p class="c4 c0"><span></span></p><p class="c0"><span class="c3 c18">Metodo checkIdMolecule (id)</span></p><p class="c0"><span class="c3">- id &rarr; id della molecola da cercare nel DB</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>Controlla se l&rsquo;id della molecola passata come parametro &egrave; valida: l&rsquo;id &egrave; valido se &egrave; composto da un minimo di 1 ad un massimo di 3 caratteri, che consistono di numeri e/o lettere maiuscole.</span></p><p class="c0"><span>La funzione ritorna un booleano (true se l&rsquo;id &egrave; valido, false altrimenti).</span></p><p class="c4 c0"><span></span></p><p class="c4 c0"><span></span></p><p class="c0"><span class="c3 c18">Metodo checkName (name)</span></p><p class="c0"><span class="c3">- name &rarr; nome della proteina o della molecola da cercare nel DB</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>Controlla se il nome della molecola passata come parametro &egrave; valido: un nome &egrave; valido se &egrave; composto da almeno un carattere alfanumerico (minuscolo e/o maiuscolo) e/o dai caratteri speciali &lsquo;-&rsquo;, &lsquo;_&rsquo; .</span></p><p class="c0"><span>La funzione ritorna un booleano (true se il nome &egrave; valido, false altrimenti).</span></p><p class="c4 c0"><span></span></p><p class="c4 c0"><span></span></p><p class="c0"><span class="c3 c18">Metodo transformToList (string, separator)</span></p><p class="c0"><span class="c3">- string &rarr; stringa di caratteri</span></p><p class="c0"><span class="c3">- separator &rarr; carattere che ricorre nella stringa, usato come separatore di caratteri</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>Trasforma la stringa di caratteri passata come parametro in un array di elementi (e lo ritorna). Ogni elemento corrisponde a tutti i caratteri compresi tra un separatore e l&rsquo;altro.<br>Tipicamente la stringa comprende una serie di id separati da virgole.</span></p><p class="c0"><span>Se il separatore non &egrave; presente nella stringa, la funzione ritorna un unico array contente la stringa stessa.</span></p><p class="c4 c0"><span></span></p><p class="c4 c0"><span></span></p><p class="c0"><span class="c3 c18">Metodo checkIdListMolecule (list)</span></p><p class="c0"><span class="c3">- list &rarr; array di elementi contenenti id di molecole</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>Controlla la validit&agrave; degli id presenti in lista, applicando la funzione </span><span class="c3">checkIdMolecule(id) </span><span>a tutti gli elementi.<br>Ritorna true se tutti gli id presenti in lista sono validi, false altrimenti.</span></p><p class="c4 c0"><span></span></p><p class="c4 c0"><span></span></p><p class="c4 c0"><span></span></p><p class="c0"><span class="c9">server_express.js</span></p><p class="c0"><span>Permette di intercettare le richieste get e post per applicare le funzioni necessarie agli scopi dell&rsquo;applicazione.</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>ROUTING:</span></p><p class="c0"><span class="c6">/rest/protein/id/:id</span></p><p class="c0"><span class="c6">/rest/molecule/id/:id</span></p><p class="c0"><span>Dopo aver eseguito un controllo sulla validit&agrave; dell&rsquo;id (tramite </span><span class="c3 c19">checkIdProtein() </span><span>o </span><span class="c19 c3">checkIdMolecule() </span><span>), interagisce con </span><span class="c3">dbmodule</span><span>&nbsp;per accedere al DB. Restituisce il JSON relativo alla proteina richiesta o un JSON di errore.</span></p><p class="c4 c0"><span></span></p><p class="c0"><span class="c6">/rest/protein/name/:name</span></p><p class="c0"><span>Dopo aver eseguito un controllo sulla validit&agrave; del nome (tramite </span><span class="c19 c3">checkName() </span><span>), interagisce con </span><span class="c3">dbmodule</span><span>&nbsp;per accedere al DB. Restituisce un JSON contenente tutti gli id delle proteine con nome simile o un JSON di errore.</span></p><p class="c4 c0"><span></span></p><p class="c0"><span class="c6">/rest/protein/byamino/atleastone/:list</span></p><p class="c0"><span>Dopo aver eseguito un controllo sulla validit&agrave; degli id della lista di amminoacidi (molecole) (tramite </span><span class="c19 c3">checkIdListMolecule() </span><span>), interagisce con </span><span class="c3">dbmodule</span><span>&nbsp;per accedere al DB. </span></p><p class="c0"><span>Cerca tutte le proteine che contengono almeno un amminoacido specificato in lista e restituisce un JSON lista di id di proteine o un JSON di errore.</span></p><p class="c4 c0"><span></span></p><p class="c0"><span class="c6">/rest/protein/byamino/all/:list</span></p><p class="c0"><span>Dopo aver eseguito un controllo sulla validit&agrave; degli id della lista di amminoacidi (molecole) (tramite </span><span class="c19 c3">checkIdListMolecule() </span><span>), interagisce con </span><span class="c3">dbmodule</span><span>&nbsp;per accedere al DB. </span></p><p class="c0"><span>Cerca tutte le proteine che contengono tutti gli amminoacidi specificati in lista e restituisce un JSON lista di id di proteine o un JSON di errore.</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>n.b. :list == lista di id di amminoacidi separati da virgola (es: GLY,VAL)</span></p><p class="c4 c0"><span class="c6"></span></p><p class="c0"><span>TODO:<br>routing per ottenere la lista completa degli id (proteine + amminoacidi)</span></p><h1 class="c0"><a name="h.nhjevdv29e6q"></a><span>Parser</span></h1><p class="c0"><span>Il modulo parser legge elementi in formato PDB e li trasforma in oggetti json, pi&ugrave; facili e veloci da leggere.</span></p><p class="c0"><img height="315" src="images/image01.png" width="367"></p><p class="c4 c0"><span></span></p><p class="c4 c0"><span></span></p><h3 class="c11 c0"><a name="h.m6rxzemhk8f8"></a></h3><h3 class="c11 c0"><a name="h.rv8qu5qcai7m"></a></h3><h3 class="c11 c0"><a name="h.346dsodbgsfp"></a></h3><h3 class="c11 c0"><a name="h.tke5qobaxchy"></a></h3><h3 class="c11 c0"><a name="h.qlae4ivefm7l"></a></h3><h3 class="c11 c0"><a name="h.pkafyyxml9n6"></a></h3><h3 class="c11 c0"><a name="h.nif9fev8gfg"></a></h3><h3 class="c11 c0"><a name="h.i4b6q85x2ce1"></a></h3><h3 class="c11 c0"><a name="h.ii1j97a0si42"></a></h3><h3 class="c0"><a name="h.cjuox3utcm49"></a><span>Input</span></h3><h4 class="c0"><a name="h.rnq800t5lh4p"></a><span class="c18">Proteine, aminoacidi e monomeri in formato PDB</span></h4><p class="c0"><span>Il formato PDB (Protein Data Bank file format) &nbsp;&egrave; utilizzato per descrivere la struttura tridimensionale delle molecole conservate nella Protein Data Bank.</span></p><p class="c0"><span>E&rsquo; stato scelto questo formato per la grande quantit&agrave; di proteine disponibili (la Protein Data Bank ha superato le 80.000 proteine archiviate a marzo 2012).</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>La documentazione del formato &egrave; disponibile qui:</span></p><p class="c0"><span class="c1"><a class="c2" href="http://www.wwpdb.org/docs.html">http://www.wwpdb.org/docs.html</a></span></p><p class="c4 c0"><span class="c9"></span></p><h3 class="c0"><a name="h.e7kpm1is0s24"></a><span>Output</span></h3><p class="c4 c0"><span></span></p><p class="c0"><span>L&rsquo;output del parser &egrave; un oggetto in formato json, composto da coppie chiave-valore che rappresentano le informazioni contenute nel pdb in modo facilmente comprensibile per l&rsquo;utente.</span></p><p class="c0"><span>L&rsquo;oggetto contiene diversi tipi di entry:</span></p><h4 class="c0"><a name="h.vd31j6umtxu1"></a><span class="c18">Rappresentazione di record</span></h4><p class="c0"><span>La chiave &egrave; il nome di 6 caratteri del record PDB, al quale vengono tolti gli spazi superflui (es: &ldquo;JRNL &nbsp;&rdquo; diventa &ldquo;JRNL&rdquo;). Il contenuto &egrave; a sua volta un json che rappresenta il contenuto del record.</span></p><p class="c0"><span>Alcuni record possono comparire pi&ugrave; di una volta:</span></p><p class="c0"><span>In questo caso alla chiave &egrave; associato un json contenente come chiavi dei numeri seriali e come valori i json che rappresentano i singoli record, pi&ugrave; un attributo &ldquo;_count&rdquo; in cui &egrave; salvato il numero di record contenuti nell&rsquo;oggetto.</span></p><h4 class="c0"><a name="h.jawz7hl3sa09"></a><span class="c18">Campi dei record</span></h4><p class="c0"><span>Per leggere un campo di un record PDB &egrave; necessario conoscere gli indici delle colonne in cui esso &egrave; scritto.</span></p><p class="c0"><span>Nel json parsato relativo a un record, invece, i campi possono essere acceduti usando come chiave il &ldquo;field name&rdquo; riportato nella documentazione.</span></p><p class="c0"><span>Questo semplifica l&rsquo;accesso ai dati e consente ad un utente di farsi un&rsquo;idea del contenuto del json semplicemente stampando l&rsquo;oggetto.</span></p><h4 class="c4 c0"><a name="h.2ykla3tmnt48"></a></h4><h4 class="c4 c0"><a name="h.wu6iciltsu2z"></a></h4><h4 class="c4 c0"><a name="h.p6l5z5escrsf"></a></h4><h4 class="c4 c0"><a name="h.w9xbz8l18uzo"></a></h4><h4 class="c4 c0"><a name="h.qdrmxk8ued8g"></a></h4><h4 class="c4 c0"><a name="h.8lshzqmcw3g5"></a></h4><h4 class="c4 c0"><a name="h.413gqh9w187l"></a></h4><h4 class="c0"><a name="h.sd8mtkvc5kh0"></a><span class="c18">Record di &ldquo;raggruppamento&rdquo;</span></h4><p class="c0"><span>Alcuni record (in particolare &ldquo;MODEL&rdquo;) raggruppano altri tipi di record.</span></p><p class="c0"><span>In questo caso all&rsquo;interno del json associato al record di raggruppamento compaiono sia gli attributi del record stesso (es: &ldquo;serial&rdquo;), sia i json dei record raggruppati.</span></p><p class="c4 c0"><span></span></p><p class="c0"><img height="328" src="images/image00.png" width="537"></p><p class="c4 c0"><span></span></p><p class="c0"><span>Un esempio dell&rsquo;output del parser pu&ograve; essere trovato qui:</span></p><p class="c0"><span class="c1"><a class="c2" href="https://raw.github.com/cvdlab-bio/webpdb/develop/docs/jsons/2LGB-pretty-print.json">https://raw.github.com/cvdlab-bio/webpdb/develop/docs/jsons/2LGB-pretty-print.json</a></span></p><h1 class="c0"><a name="h.8i8c70tvav8t"></a><span>CouchDB</span></h1><h3 class="c0"><a name="h.bybcacy042bs"></a><span>Moduli necessari</span></h3><h4 class="c0"><a name="h.ag03a2vyygoo"></a><span class="c20 c18">Cradle</span></h4><p class="c0"><span>Cradle &egrave; un client asincrono per CouchDB. Consente l&rsquo;interazione con CouchDB attraverso Node.js</span></p><h5 class="c0"><a name="h.w74t47202wqn"></a><span>Installazione</span></h5><p class="c0"><span>Il modulo si installa attraverso il gestore di package di Node.js </span><span class="c3">npm, </span><span>con il comando:</span></p><p class="c4 c0"><span></span></p><a href="#" name="3462979d612313dc2d827a77549cd6176162f7a5"></a><a href="#" name="2"></a><table cellpadding="0" cellspacing="0" class="c5"><tbody><tr><td class="c13"><p class="c16 c0"><span>$ npm install cradle</span></p></td></tr></tbody></table><p class="c4 c0"><span></span></p><p class="c0"><span>E&rsquo; necessaria ovviamente l&rsquo;installazione sulla macchina di Node.js e di un compilatore g++ (es. XCODE per MacOSX).</span></p><p class="c0"><span>Per utilizzare cradle &egrave; sufficiente caricare il modulo &lsquo;</span><span class="c3">cradle</span><span>&rsquo; all&rsquo;inizio del file:</span></p><p class="c4 c0"><span></span></p><a href="#" name="8a1e353e926a13691b3e146bedc86a6ec7d335c9"></a><a href="#" name="3"></a><table cellpadding="0" cellspacing="0" class="c5"><tbody><tr><td class="c13"><p class="c16 c0"><span>var cradle = require(&lsquo;cradle&rsquo;)</span></p></td></tr></tbody></table><p class="c4 c0"><span></span></p><p class="c0"><span>e quindi richiamare sulla variabile utilizzata per il caricamento le funzioni di cradle:</span></p><p class="c4 c0"><span></span></p><a href="#" name="a21a294d32c1720c15b20f100c3e13f5863b5f9b"></a><a href="#" name="4"></a><table cellpadding="0" cellspacing="0" class="c5"><tbody><tr><td class="c13"><p class="c16 c0"><span>cradle.connection(...)</span></p></td></tr></tbody></table><p class="c4 c0"><span></span></p><h3 class="c0"><a name="h.rreyr2xldrxp"></a><span>Avvio CouchDB</span></h3><p class="c0"><span>Per utilizzare CouchDB, sia per operazioni di modifica (inserimento, cancellazione, etc) che di retrieve, &egrave; necessario avviarlo: &egrave; possibile fare ci&ograve; in due modi:</span></p><h4 class="c0"><a name="h.ti1czsm3a8ze"></a><span>Terminale</span></h4><p class="c0"><span>Basta usare da terminale il comando:</span></p><p class="c4 c0"><span></span></p><a href="#" name="195025077a21e26d9af1bf1ab451c2a7ae2bd530"></a><a href="#" name="5"></a><table cellpadding="0" cellspacing="0" class="c5"><tbody><tr><td class="c13"><p class="c16 c0"><span>$ couchdb</span></p></td></tr></tbody></table><p class="c4 c0"><span></span></p><h2 class="c0"><a name="h.pujkyqqc3quz"></a><span class="c3 c22">Configurazione</span></h2><p class="c0"><span>Per evitare problemi in caso di JSON molto nidificati e view molto onerose &egrave; necessario configurare il local.ini con:</span></p><p class="c4 c0"><span></span></p><a href="#" name="f388aae44d3ed4e86e4c617752669dc05f923545"></a><a href="#" name="6"></a><table cellpadding="0" cellspacing="0" class="c5"><tbody><tr><td class="c13"><p class="c0"><span>[couchdb]</span></p><p class="c0"><span>delayed_commits = false</span></p><p class="c0"><span>os_process_timeout = 60000</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>[query_servers]</span></p><p class="c0"><span>javascript = /usr/local/bin/couchjs -S 4294967296 /usr/local/share/couchdb/server/main.js</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>[query_server_config]</span></p><p class="c0"><span>reduce_limit = false</span></p><p class="c0"><span>os_process_limit = 100</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>[httpd]<br>x_forwarded_host = FNORD<br>socket_options = [{nodelay, true}]</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>[native_query_servers]</span></p><p class="c0"><span>erlang = {couch_native_process, start_link, []}</span></p></td></tr></tbody></table><p class="c4 c0"><span></span></p><p class="c4 c0"><span></span></p><h4 class="c0"><a name="h.kfthkdoa9hhv"></a><span>Interfaccia web</span></h4><p class="c0"><span>CouchDB mette a disposizione una piccola interfaccia web che consente l&rsquo;interazione con il database per tutte le operazioni. L&rsquo;interfaccia &egrave; accedibile utilizzando dal browser l&rsquo;URL:</span></p><p class="c4 c0"><span></span></p><a href="#" name="db07ca3bac71b879091371f82ad214cfd23d5647"></a><a href="#" name="7"></a><table cellpadding="0" cellspacing="0" class="c5"><tbody><tr><td class="c13"><p class="c16 c0"><span>http://127.0.0.1:5984/_utils</span></p></td></tr></tbody></table><p class="c0"><span>&nbsp;</span></p><p class="c0"><span>Con l&rsquo;interfaccia attiva &egrave; attivo anche il DB in locale, dunque &egrave; possibile utilizzarlo come se fosse stato fatto partire da terminale.</span></p><a href="#" name="id.zbcn7jfb5xti"></a><h3 class="c0"><a name="h.i29ch5wq3l8r"></a><span>Views</span></h3><p class="c0"><span>Le views per le materializzazioni nelle funzioni di Map sono gestite in modo tale da ottimizzare le prestazioni in caso di query simili effettuate consecutivamente. I nomi delle views sono creati applicando una funzione di hash (MD5) ad una stringa formata di volta in volta da: nome della query, parola chiave associata al DB in questione e stringa sul quale viene effettuata l&rsquo;interrogazione (ad esempio uno specifico id od un nome) (</span><span class="c3">vedi modulo </span><span class="c1 c3"><a class="c2" href="#id.cmmkdr6y2iay">hash</a></span><span>). Cos&igrave; facendo si creano delle viste specifiche per ogni query eseguita, in modo tale che se dovesse essere eseguita la stessa query, (non per forza di seguito, anche intervallata fa altre operazioni) Couch riutilizzerebbe la vecchia vista creata in precedenza a seguito della prima interrogazione, rispondendo pi&ugrave; velocemente alla richiesta dell&rsquo;utente. Per la funzione hash si utilizza il modulo </span><span class="c1 c3"><a class="c2" href="http://nodejs.org/docs/v0.3.1/api/crypto.html">Crypto</a></span><span class="c3">&nbsp;</span><span>di Node.js.</span></p><a href="#" name="id.cmmkdr6y2iay"></a><h3 class="c0"><a name="h.gotrmfmfw91s"></a><span>Module hash</span></h3><p class="c0"><span>Contiene il solo metodo </span><span class="c3">createHash(input) </span><span>che riceve in input un array di stringhe ed applica una funzione di hash alla concatenazione delle stesse. E&rsquo; utilizzato nella creazione delle </span><span class="c1 c3"><a class="c2" href="#id.zbcn7jfb5xti">views</a></span><span class="c3">&nbsp;</span><span>al fine di ottimizzare le prestazioni di CouchDB. Utilizza il modulo </span><span class="c1 c3"><a class="c2" href="http://nodejs.org/docs/v0.3.1/api/crypto.html">Crypto</a></span><span class="c3">&nbsp;</span><span>di Node.js.</span></p><p class="c4 c0"><span></span></p><h3 class="c0"><a name="h.5yhjiylrly63"></a><span>Module get</span></h3><h4 class="c0"><a name="h.19pp2p34697v"></a><span class="c18">Metodo retrieveByID(id, callbackFunction, keyDB)</span></h4><p class="c0"><span class="c3">- id &rarr; id sul quale eseguire la query</span></p><p class="c0"><span class="c3">- callBackFunction &rarr; funzione del tipo function(boolean, result), sar&agrave; invocata sul risultato della query</span></p><p class="c0"><span class="c3">- keyDB &rarr; identificatore del DB sul quale effettuare la query (vedi </span><span class="c1 c3"><a class="c2" href="#id.hnd2yxk6i6fq">databases.json</a></span><span class="c3">)</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>Restituisce (se presente) il documento con id specificato nel DB con il nome specificato. Se non sono stati riscontrati errori, invoca la </span><span class="c3">callBackFunction </span><span>su &lsquo;true&rsquo; e sul documento restituito dalla query; in caso di errore, la invoca su &lsquo;false&rsquo; e sul </span><span class="c3">json</span><span>&nbsp;dell&rsquo;errore riscontrato. L&rsquo;utente pu&ograve; utilizzare il risultato della query solo attraverso la </span><span class="c3">callBackFunction.</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>ES.</span></p><a href="#" name="59f64537acb3512ef40f217684ae64dee6b08951"></a><a href="#" name="8"></a><table cellpadding="0" cellspacing="0" class="c5"><tbody><tr class="c8"><td class="c13"><p class="c16 c0"><span>var dbmodule = require(&lsquo;./get&rsquo;);</span></p><p class="c4 c16 c0"><span></span></p><p class="c16 c0"><span>//</span><span class="c3">semplice funzione di callback che si limita a stampare il risultato ottenuto dalla query</span></p><p class="c16 c0"><span>var callBack = function(bool, result){</span></p><p class="c16 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp;console.log(result);</span></p><p class="c16 c0"><span>}</span></p><p class="c4 c16 c0"><span></span></p><p class="c16 c0"><span>dbmodule.retrieveByID(1234, &lsquo;characterDB&rsquo;);</span></p></td></tr></tbody></table><p class="c4 c0"><span></span></p><p class="c0"><span>Le credenziali di accesso al DB </span><span class="c3">username </span><span>e </span><span class="c3">&nbsp;password, host </span><span>e </span><span class="c3">porta </span><span>per la connessione sono specificati all&rsquo;interno del file </span><span class="c1 c3"><a class="c2" href="#id.eppuijs6qay">config.json</a></span><span class="c3">.</span></p><p class="c4 c0"><span></span></p><p class="c4 c0"><span></span></p><h4 class="c0"><a name="h.fare46b4k6iu"></a><span class="c18">Metodo retrieveByName(name, callbackFunction, keyDB, start, end)</span></h4><p class="c0"><span class="c3">- name &rarr; name sul quale eseguire la query</span></p><p class="c0"><span class="c3">- callBackFunction &rarr; funzione del tipo function(boolean, result), sar&agrave; invocata sul risultato della query</span></p><p class="c0"><span class="c3">- keyDB &rarr; identificatore associato al DB sul quale effettuare la query (vedi </span><span class="c1 c3"><a class="c2" href="#id.hnd2yxk6i6fq">databases.json</a></span><span class="c3">)</span></p><p class="c0"><span>- </span><span class="c3">start, end &rarr; specificano l&rsquo;intervallo dei record che verranno restituiti dalla query: se start=3 ed end=40, verranno restituiti solo i record da 3 a 40. Di default sono impostati valori start=0, end=50.</span></p><p class="c4 c0"><span class="c3"></span></p><p class="c4 c0"><span></span></p><p class="c4 c0"><span></span></p><p class="c0"><span>Restituisce (se presente) il documento con </span><span class="c3">name</span><span>&nbsp;specificato nel DB con il nome specificato, attraverso una funzione di </span><span class="c3 c20">map</span><span>. Se non sono stati riscontrati errori, invoca la </span><span class="c3">callBackFunction </span><span>su &lsquo;true&rsquo; e sul documento restituito dalla query; in caso di errore, la invoca su &lsquo;false&rsquo; e sul </span><span class="c3">json</span><span>&nbsp;dell&rsquo;errore riscontrato. L&rsquo;utente pu&ograve; utilizzare il risultato della query solo attraverso la </span><span class="c3">callBackFunction. </span><span>Utilizza </span><span class="c1 c3"><a class="c2" href="#id.w95cqy5fjesg">mapContains</a></span><span class="c3">&nbsp;</span><span>del modulo </span><span class="c1 c3"><a class="c2" href="#id.elsdrhbbc6jw">queryGenerator</a></span><span class="c3">&nbsp;</span><span>(specificando come </span><span class="c3">field </span><span>il campo </span><span class="c3">&ldquo;TITLE.content&rdquo;</span><span>)</span><span class="c3">.</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>ES.</span></p><a href="#" name="d96cf8a436baa4bae6de1e8da99d6202a04cc441"></a><a href="#" name="9"></a><table cellpadding="0" cellspacing="0" class="c5"><tbody><tr class="c8"><td class="c13"><p class="c16 c0"><span>var dbmodule = require(&lsquo;./get&rsquo;);</span></p><p class="c4 c16 c0"><span></span></p><p class="c16 c0"><span>//</span><span class="c3">semplice funzione di callback che si limita a stampare il risultato ottenuto dalla query</span></p><p class="c16 c0"><span>var callBack = function(bool, result){</span></p><p class="c16 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp;console.log(result);</span></p><p class="c16 c0"><span>}</span></p><p class="c4 c0 c16"><span></span></p><p class="c16 c0"><span>dbmodule.retrieveByName(&lsquo;pippo&rsquo;,callBack,&lsquo;characterDB&rsquo;);</span></p></td></tr></tbody></table><p class="c4 c0"><span></span></p><p class="c4 c0"><span></span></p><p class="c0"><span>Le credenziali di accesso al DB </span><span class="c3">username </span><span>e </span><span class="c3">&nbsp;password, host </span><span>e </span><span class="c3">porta </span><span>per la connessione sono specificati all&rsquo;interno del file </span><span class="c1 c3"><a class="c2" href="#id.eppuijs6qay">config.json</a></span><span class="c3">.</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c4 c0"><span></span></p><h4 class="c0"><a name="h.bdjt7ymqf9a9"></a><span class="c18">Metodo retrieveByAlmostOneAminoacid(aminoacids, callbackFunction, keyDB, start, end)</span></h4><p class="c0"><span class="c3">- aminoacids &rarr; array di aminoacidi &nbsp;sul quale eseguire la query</span></p><p class="c0"><span class="c3">- callBackFunction &rarr; funzione del tipo function(boolean, result), sar&agrave; invocata sul risultato della query</span></p><p class="c0"><span class="c3">- keyDB &rarr; identificatore associato al DB sul quale effettuare la query (vedi </span><span class="c1 c3"><a class="c2" href="#id.hnd2yxk6i6fq">databases.json</a></span><span class="c3">)</span></p><p class="c0"><span>- </span><span class="c3">start, end &rarr; specificano l&rsquo;intervallo dei record che verranno restituiti dalla query: se start=3 ed end=40, verranno restituiti solo i record da 3 a 40. Di default sono impostati valori start=0, end=50.</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>Restituisce (se presente) i documenti che contengono almeno uno degli aminoacidi specificati nel DB con il nome specificato, attraverso una funzione di </span><span class="c3 c20">map</span><span>. Se non sono stati riscontrati errori, invoca la </span><span class="c3">callBackFunction </span><span>su &lsquo;true&rsquo; e sul documento restituito dalla query; in caso di errore, la invoca su &lsquo;false&rsquo; e sul </span><span class="c3">json</span><span>&nbsp;dell&rsquo;errore riscontrato. L&rsquo;utente pu&ograve; utilizzare il risultato della query solo attraverso la </span><span class="c3">callBackFunction. </span><span>Utilizza </span><span class="c1"><a class="c2" href="#id.k2ft2749v3ao">a</a></span><span class="c1 c3"><a class="c2" href="#id.k2ft2749v3ao">lmostOneAminoacid</a></span><span class="c3">&nbsp;</span><span>del modulo </span><span class="c1 c3"><a class="c2" href="#id.elsdrhbbc6jw">queryGenerator</a></span><span>.</span></p><h4 class="c0"><a name="h.cztvlno4klvh"></a><span class="c18">Metodo retrieveByAllAminoacids(aminoacids, callbackFunction, keyDB, start, end)</span></h4><p class="c0"><span class="c3">- aminoacids &rarr; array di aminoacidi &nbsp;sul quale eseguire la query</span></p><p class="c0"><span class="c3">- callBackFunction &rarr; funzione del tipo function(boolean, result), sar&agrave; invocata sul risultato della query</span></p><p class="c0"><span class="c3">- keyDB &rarr; identificatore associato al DB sul quale effettuare la query (vedi </span><span class="c1 c3"><a class="c2" href="#id.hnd2yxk6i6fq">databases.json</a></span><span class="c3">)</span></p><p class="c0"><span>- </span><span class="c3">start, end &rarr; specificano l&rsquo;intervallo dei record che verranno restituiti dalla query: se start=3 ed end=40, verranno restituiti solo i record da 3 a 40. Di default sono impostati valori start=0, end=50.</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>Restituisce (se presenti) i documenti che contengono tutti gli aminoacidi specificati nel DB con il nome specificato, attraverso una funzione di </span><span class="c3 c20">map</span><span>. Se non sono stati riscontrati errori, invoca la </span><span class="c3">callBackFunction </span><span>su &lsquo;true&rsquo; e sul documento restituito dalla query; in caso di errore, la invoca su &lsquo;false&rsquo; e sul </span><span class="c3">json</span><span>&nbsp;dell&rsquo;errore riscontrato. L&rsquo;utente pu&ograve; utilizzare il risultato della query solo attraverso la </span><span class="c3">callBackFunction. </span><span>Utilizza </span><span class="c1"><a class="c2" href="#id.82ztm34ocmfp">a</a></span><span class="c1 c3"><a class="c2" href="#id.82ztm34ocmfp">llAminoacids</a></span><span class="c3">&nbsp;</span><span>del modulo </span><span class="c1 c3"><a class="c2" href="#id.elsdrhbbc6jw">queryGenerator</a></span><span>.</span></p><p class="c4 c0"><span></span></p><p class="c0"><span class="c18">Metodo retrieveAllIDs(callbackFunction, keyDB)</span></p><p class="c0"><span class="c3">- callBackFunction &rarr; funzione del tipo function(boolean, result), sar&agrave; invocata sul risultato della query</span></p><p class="c0"><span class="c3">- keyDB &rarr; identificatore associato al DB sul quale effettuare la query (vedi </span><span class="c1 c3"><a class="c2" href="#id.hnd2yxk6i6fq">databases.json</a></span><span class="c3">)</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>Restituisce gli id di tutti i documenti nel DB con il nome specificato, attraverso una funzione di </span><span class="c3 c20">map</span><span>. Se non sono stati riscontrati errori, invoca la </span><span class="c3">callBackFunction </span><span>su &lsquo;true&rsquo; e sul documento restituito dalla query; in caso di errore, la invoca su &lsquo;false&rsquo; e sul </span><span class="c3">json</span><span>&nbsp;dell&rsquo;errore riscontrato. L&rsquo;utente pu&ograve; utilizzare il risultato della query solo attraverso la </span><span class="c3">callBackFunction. </span><span>Utilizza </span><span class="c1 c3"><a class="c2" href="#id.ryjbjetb69kr">hasID</a></span><span class="c3">&nbsp;</span><span>del modulo </span><span class="c1 c3"><a class="c2" href="#id.elsdrhbbc6jw">queryGenerator</a></span><span>.</span></p><p class="c4 c0"><span></span></p><h4 class="c0"><a name="h.kg72nm91uuxq"></a><span class="c18">Metodo retrieveAllNameID(callbackFunction, keyDB)</span></h4><p class="c0"><span class="c3">- callBackFunction &rarr; funzione del tipo function(boolean, result), sar&agrave; invocata sul risultato della query</span></p><p class="c0"><span class="c3">- keyDB &rarr; identificatore associato al DB sul quale effettuare la query (vedi </span><span class="c1 c3"><a class="c2" href="#id.hnd2yxk6i6fq">databases.json</a></span><span class="c3">)</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>Restituisce delle coppie (</span><span class="c3">TITLE.title, id</span><span>) di tutti i documenti nel DB con il nome specificato, attraverso una funzione di </span><span class="c3 c20">map</span><span>. Se non sono stati riscontrati errori, invoca la </span><span class="c3">callBackFunction </span><span>su &lsquo;true&rsquo; e sul documento restituito dalla query; in caso di errore, la invoca su &lsquo;false&rsquo; e sul </span><span class="c3">json</span><span>&nbsp;dell&rsquo;errore riscontrato. L&rsquo;utente pu&ograve; utilizzare il risultato della query solo attraverso la </span><span class="c3">callBackFunction. </span><span>Utilizza </span><span class="c1 c3"><a class="c2" href="#id.1q71m3i0vdtv">hasNameID</a></span><span class="c3">&nbsp;</span><span>del modulo </span><span class="c1 c3"><a class="c2" href="#id.elsdrhbbc6jw">queryGenerator</a></span><span>.</span></p><p class="c4 c0"><span></span></p><h4 class="c0"><a name="h.yskj2mpm593d"></a><span class="c18">Metodo retrieveByAlmostOneAminoacidSeqResAverage(aminoacids, callbackFunction, keyDB, start, end) </span><span class="c20">[funzione utile solo a fini di test]</span></h4><p class="c0"><span class="c3">- aminoacids &rarr; array di aminoacidi &nbsp;sul quale eseguire la query</span></p><p class="c0"><span class="c3">- callBackFunction &rarr; funzione del tipo function(boolean, result), sar&agrave; invocata sul risultato della query</span></p><p class="c0"><span class="c3">- keyDB &rarr; identificatore associato al DB sul quale effettuare la query (vedi </span><span class="c1 c3"><a class="c2" href="#id.hnd2yxk6i6fq">databases.json</a></span><span class="c3">)</span></p><p class="c0"><span>- </span><span class="c3">start, end &rarr; specificano l&rsquo;intervallo dei record che verranno restituiti dalla query: se start=3 ed end=40, verranno restituiti solo i record da 3 a 40. Di default sono impostati valori start=0, end=50.</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>Restituisce la media di tutti i valori del campo SEQRES dei documenti, nel DB con nome specificato, che hanno almeno un aminoacido di quelli specificati nel parametro </span><span class="c3">aminoacids </span><span>attraverso una funzione di </span><span class="c3 c20">map</span><span>-</span><span class="c3 c20">reduce</span><span>. Se non sono stati riscontrati errori, invoca la </span><span class="c3">callBackFunction </span><span>su &lsquo;true&rsquo; e sul documento restituito dalla query; in caso di errore, la invoca su &lsquo;false&rsquo; e sul </span><span class="c3">json</span><span>&nbsp;dell&rsquo;errore riscontrato. L&rsquo;utente pu&ograve; utilizzare il risultato della query solo attraverso la </span><span class="c3">callBackFunction. </span><span>E&rsquo; stata implementata solo per testare efficienza ed efficacia della </span><span class="c3 c20">&nbsp;map-reduce</span><span>, poich&egrave; le altre funzioni implementate prevedevano solo </span><span class="c3 c20">map. </span><span>Utilizza </span><span class="c3">almostOneAminoacidCountValue </span><span>del modulo </span><span class="c1 c3"><a class="c2" href="#id.elsdrhbbc6jw">queryGenerator</a></span><span>.</span></p><h3 class="c0"><a name="h.di7q06jqen5a"></a><span>Module insert</span></h3><h4 class="c0"><a name="h.6fx856d24k83"></a><span class="c18">Metodo insert(id, json, callbackFunction, keyDB)</span></h4><p class="c0"><span class="c3">- id &rarr; id del documento da inserire; pu&ograve; essere di qualunque tipo</span></p><p class="c0"><span class="c3">- json &rarr; json del documento da inserire</span></p><p class="c0"><span class="c3">- callBackFunction &rarr; funzione del tipo function(boolean, result), sar&agrave; invocata sul risultato della query</span></p><p class="c0"><span class="c3">- keyDB &rarr; identificatore associato al DB sul quale effettuare la query (vedi </span><span class="c1 c3"><a class="c2" href="#id.hnd2yxk6i6fq">databases.json</a></span><span class="c3">)</span></p><h3 class="c0 c11"><a name="h.2tu9dlkdxmmf"></a></h3><p class="c0"><span>Inserisce nel DB con il nome specificato un nuovo documento con </span><span class="c3">id </span><span>specificato e </span><span class="c3">json </span><span>passato come parametro. Nel caso in cui sia gi&agrave; presente un documento con l&rsquo;</span><span class="c3">id </span><span>specificato, non riporta errori, ma si limita ad aggiornare il documento (se non c&rsquo;&egrave; alcuna modifica da effettuare verr&agrave; cambiato solo il numero di versione, ovvero l&rsquo;attributo &ldquo;</span><span class="c3">_rev</span><span>&rdquo;, posseduto da tutti i documenti in CouchDB). Se non sono stati riscontrati errori, invoca la </span><span class="c3">callBackFunction </span><span>su &lsquo;true&rsquo; e sul documento restituito dalla query; in caso di errore, la invoca su &lsquo;false&rsquo; e sul </span><span class="c3">json</span><span>&nbsp;dell&rsquo;errore riscontrato. </span></p><p class="c4 c0"><span></span></p><p class="c4 c0"><span></span></p><p class="c0"><span>ES.</span></p><a href="#" name="4794b08b77247e976c87009796bafbd1a512f4dc"></a><a href="#" name="10"></a><table cellpadding="0" cellspacing="0" class="c5"><tbody><tr><td class="c13"><p class="c16 c0"><span>//</span><span class="c3">semplice funzione di callback che si limita a stampare il risultato ottenuto dalla query</span></p><p class="c16 c0"><span>var callBack = function(bool, result){</span></p><p class="c16 c0"><span>&nbsp; &nbsp; &nbsp; &nbsp;console.log(result);</span></p><p class="c16 c0"><span>}</span></p><p class="c4 c16 c0"><span></span></p><p class="c16 c0"><span>var object = {</span></p><p class="c16 c0"><span>name: &lsquo;pippo&rsquo;, </span></p><p class="c16 c0"><span>surname: &rsquo;pluto&rsquo;, </span></p><p class="c16 c0"><span>age: &lsquo;24&rsquo;</span></p><p class="c16 c0"><span>};</span></p><p class="c4 c16 c0"><span></span></p><p class="c16 c0"><span>insert(&lsquo;12345&rsquo;, object,&lsquo;characterDB&rsquo;);</span></p></td></tr></tbody></table><p class="c4 c0"><span></span></p><p class="c4 c0"><span></span></p><p class="c0"><span>Le credenziali di accesso al DB </span><span class="c3">username </span><span>e </span><span class="c3">&nbsp;password, host </span><span>e </span><span class="c3">porta </span><span>per la connessione sono specificati all&rsquo;interno del file </span><span class="c1 c3"><a class="c2" href="#id.eppuijs6qay">config.json.</a></span></p><p class="c4 c0"><span></span></p><h3 class="c0"><a name="h.oa61yyx89ng2"></a><span>Module db</span></h3><p class="c0"><span>Il modulo &egrave; utilizzato dai moduli </span><span class="c3">get </span><span>e </span><span class="c3">insert </span><span>per configurare l&rsquo;accesso al DB. Contiene il metodo </span><span class="c3">setup</span><span>(</span><span class="c3">options, callBackFunction</span><span>) che attraverso il file </span><span class="c3">&nbsp;</span><span class="c1 c3"><a class="c2" href="#id.eppuijs6qay">config.json</a></span><span>&nbsp;ottiene la connessione al database e ne restituisce l&rsquo;istanza al modulo che l&rsquo;ha utilizzato. Il parametro </span><span class="c3">options </span><span>&egrave; usato per passare parametri alla funzione, in particolare la </span><span class="c3">keyDB </span><span>del DB relativa al database quale si vuole accedere.</span></p><p class="c4 c0"><span></span></p><a href="#" name="id.elsdrhbbc6jw"></a><h3 class="c0"><a name="h.3r208pwz7j7b"></a><span>Module queryGenerator</span></h3><p class="c0"><span>E&rsquo; utilizzato dal modulo </span><span class="c3">get </span><span>per creare dinamicamente query da eseguire. CouchDB offre la possibilit&agrave; di passare query (in particolare operazioni di MapReduce) come stringhe, dunque </span><span class="c3">queryGenerator </span><span>possiede dei template standard che utilizza per creare al volo query specifiche in base ai parametri che il modulo </span><span class="c3">get </span><span>gli passa come parametro, e le restituisce sotto forma di stringhe</span></p><p class="c4 c0"><span></span></p><a href="#" name="id.w95cqy5fjesg"></a><h4 class="c0"><a name="h.jx290so8q1ti"></a><span class="c18">mapContains(field, string)</span></h4><p class="c0"><span>Genera una query che attraverso un&rsquo;operazione di Map richiede gli </span><span class="c3">id </span><span>delle istanze del DB che nel campo </span><span class="c3">field </span><span>contengono la stringa </span><span class="c3">string.</span></p><a href="#" name="kix.lwu5tvqnw9cc"></a><h4 class="c0"><a name="h.vj2bhvo5vkt0"></a><span class="c18">mapEqual(field, string)</span></h4><p class="c0"><span>Genera una query che attraverso un&rsquo;operazione di Map richiede gli </span><span class="c3">id </span><span>delle istanze del DB con campo </span><span class="c3">field </span><span>uguale alla stringa </span><span class="c3">string.</span></p><a href="#" name="kix.qd9ojshadarz"></a><h4 class="c0"><a name="h.puw9ehuxh0bc"></a><span class="c18">mapDisEqual(field, string)</span></h4><p class="c0"><span>Genera una query che attraverso un&rsquo;operazione di Map richiede gli </span><span class="c3">id </span><span>delle istanze del DB con campo </span><span class="c3">field </span><span>diverso dalla stringa </span><span class="c3">string.</span></p><h4 class="c0"><a name="h.v9403vbrypmu"></a><span class="c18">mapGreaterThan(field, minVal)</span></h4><p class="c0"><span>Genera una query che attraverso un&rsquo;operazione di Map richiede le istanze del DB con valore del campo </span><span class="c3">field </span><span>minore (&lsquo;&lt;&rsquo;) del valore </span><span class="c3">minVal.</span></p><a href="#" name="kix.gk1xcmr75ucb"></a><h4 class="c0"><a name="h.kg3tgnizyky2"></a><span class="c18">mapLessThan(field, maxVal)</span></h4><p class="c0"><span>Genera una query che attraverso un&rsquo;operazione di Map richiede gli </span><span class="c3">id </span><span>delle istanze del DB con valore del campo </span><span class="c3">field </span><span>maggiore (&lsquo;&gt;&rsquo;) del valore </span><span class="c3">maxVal.</span></p><a href="#" name="kix.a1fcixuq4dr"></a><h4 class="c0"><a name="h.oa39zsfdqavr"></a><span class="c18">mapBetween(field, minVal, maxVal)</span></h4><p class="c0"><span>Genera una query che attraverso un&rsquo;operazione di Map richiede gli </span><span class="c3">id </span><span>delle istanze del DB con valore del campo </span><span class="c3">field </span><span>compreso tra </span><span class="c3">minVal </span><span>&nbsp;e </span><span class="c3">maxVal.</span></p><a href="#" name="id.k2ft2749v3ao"></a><h4 class="c0"><a name="h.5ms78muopqhf"></a><span class="c18">almostOneAminoacid(aminoacids)</span></h4><p class="c0"><span>Genera una query che attraverso un&rsquo;operazione di Map richiede gli </span><span class="c3">id </span><span>delle istanze del DB che contengono almeno uno degli aminoacidi specificati nell&rsquo;array </span><span class="c3">aminoacids.</span></p><a href="#" name="id.82ztm34ocmfp"></a><h4 class="c0"><a name="h.3qupe6yny3oe"></a><span class="c18">allAminoacids(aminoacids)</span></h4><p class="c0"><span>Genera una query che attraverso un&rsquo;operazione di Map richiede gli </span><span class="c3">id </span><span>delle istanze del DB che contengono tutti gli aminoacidi specificati nell&rsquo;array </span><span class="c3">aminoacids.</span></p><a href="#" name="id.ryjbjetb69kr"></a><h4 class="c0"><a name="h.ecddkdh3vrk7"></a><span class="c18">hasID(aminoacids)</span></h4><p class="c0"><span>Genera una query che attraverso un&rsquo;operazione di Map richiede gli </span><span class="c3">id </span><span>delle istanze che possiedo un id.</span></p><a href="#" name="id.1q71m3i0vdtv"></a><h4 class="c0"><a name="h.ek3u5hzpkah"></a><span class="c18">hasNameID(aminoacids)</span></h4><p class="c0"><span>Genera una query che attraverso un&rsquo;operazione di Map richiede, per le istanze che possiedono un id ed il campo </span><span class="c3">TITLE.title, </span><span>una coppia cos&igrave; formata: (doc.</span><span class="c3">TITLE.title, </span><span>doc._</span><span class="c3">id</span><span>).</span></p><a href="#" name="id.jze5ivdti747"></a><h4 class="c0"><a name="h.tu1gv2cr257k"></a><span class="c18">almostOneAminoacidCountValue(aminoacids) </span><span class="c20">[implementata solo a fini di testing]</span></h4><p class="c0"><span>Genera una query che attraverso un&rsquo;operazione di Map materializza delle coppie (id, n&deg; SEQRES) di tutte le istanze che contengono almeno un aminoacido di quelli specificati. La vista materializzata sar&agrave; utilizzata nella funzione </span><span class="c3">retrieveByAlmostOneAminoacidSeqResAverage </span><span>da una </span><span class="c3 c20">reduce </span><span>che calcola la media dei n&deg; di SEQRES</span><span class="c3 c20">.</span></p><a href="#" name="id.eppuijs6qay"></a><h3 class="c0"><a name="h.lnsub7a2w2b2"></a><span>File di configurazione config.json</span></h3><p class="c0"><span>E&rsquo; un file di configurazione acceduto da tutti i moduli succitati per ottenere le informazioni per l&rsquo;accesso al db; in particolare &egrave; strutturato come segue:</span></p><p class="c0"><span>{</span></p><p class="c0"><span>&nbsp; &quot;database&quot;: {</span></p><p class="c0"><span>&nbsp; &nbsp; &quot;host&quot;: &quot;</span><span class="c3">db&rsquo;s host</span><span>&quot;,</span></p><p class="c0"><span>&nbsp; &nbsp; &quot;port&quot;: &quot;</span><span class="c3">db&rsquo;s port</span><span>&quot;,</span></p><p class="c0"><span>&nbsp; &nbsp; &quot;userName&quot; : &quot;</span><span class="c3">db&rsquo;s username</span><span>&quot;,</span></p><p class="c0"><span>&nbsp; &nbsp; &quot;password&quot; : &quot;</span><span class="c3">db&rsquo;s password</span><span>&quot;</span></p><p class="c0"><span>&nbsp; }</span></p><p class="c0"><span>}</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>Nel caso in cui il DB non sia protetto da username e password &egrave; sufficiente impostare la stringa vuota ai campi relativi.</span></p><a href="#" name="id.hnd2yxk6i6fq"></a><h3 class="c0"><a name="h.6f5j7i7eiksk"></a><span>File databases.json</span></h3><p class="c0"><span>Contiene un lista di coppie </span><span class="c3">chiave &rarr; database. </span><span>E&rsquo; acceduto da tutti moduli precedenti che lo utilizzano per l&rsquo;accesso al DB relativo alla </span><span class="c3">keyDB </span><span>specificata nella query;</span></p><p class="c4 c0"><span></span></p><p class="c4 c0"><span></span></p><p class="c4 c0"><span></span></p><p class="c0"><span>es.</span></p><p class="c0"><span>{</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;starwars&quot; : &quot;starwars&quot;,</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;proteins&quot; : &quot;proteins_db&quot;,</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;monomers&quot; : &quot;monomers_db&quot;</span></p><p class="c0"><span>}</span></p><p class="c4 c0"><span></span></p><p class="c0"><span>Se vogliamo effettuare una query o un&rsquo;inserimento sul DB </span><span class="c3">proteins_db, </span><span>dovremo utilizzare la </span><span class="c3">keyDB &ldquo;proteins&rdquo; </span><span>quando utilizziamo i moduli sopra descritti.</span></p><p class="c4 c0"><span></span></p><p class="c4 c0"><span></span></p></body></html>